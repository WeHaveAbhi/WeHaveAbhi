<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Projects - Wehaveabhi</title>
    <!-- ... unchanged head content ... -->
</head>
<body>
    <!-- ... unchanged structure ... -->

    <!-- Example video blocks that were changed: -->
    <div class="work-item project-card" data-category="videos">
        <video autoplay muted loop playsinline style="width: 100%; height: 100%; display: block;">
            <source src="assets/video/CGICanCommercialCycleRender.mp4" type="video/mp4">
            Your browser does not support the video tag.
        </video>
        <div class="project-overlay">
            <div class="project-info">
                <h3>CGI Can Commercial</h3>
                <p>Cycle Render Video</p>
                <button class="watch-btn" data-video-src="assets/video/CGICanCommercialCycleRender.mp4">
                    <i class="fa-solid fa-play"></i> Watch Full Video
                </button>
            </div>
        </div>
    </div>

    <!-- Changed .mkv sources to have matching types (note: mkv may not play in many browsers) -->
    <div class="work-item project-card" data-category="videos">
        <video autoplay muted loop playsinline style="width: 100%; height: 100%; display: block;">
            <source src="assets/video/MechanicalWalkingCreatureCycleRender.mkv" type="video/x-matroska">
            Your browser does not support the video tag.
        </video>
        <div class="project-overlay">
            <div class="project-info">
                <h3>Mech Walker</h3>
                <p>Cycle Render Video</p>
                <button class="watch-btn" data-video-src="assets/video/MechanicalWalkingCreatureCycleRender.mkv">
                    <i class="fa-solid fa-play"></i> Watch Full Video
                </button>
            </div>
        </div>
    </div>

    <!-- Another mkv -->
    <div class="work-item project-card" data-category="videos">
        <video autoplay muted loop playsinline style="width: 100%; height: 100%; display: block;">
            <source src="assets/video/MechanicalRobotCycleRender.mkv" type="video/x-matroska">
            Your browser does not support the video tag.
        </video>
        <div class="project-overlay">
            <div class="project-info">
                <h3>Robot Anatomy</h3>
                <p>Cycle Render Video</p>
                <button class="watch-btn" data-video-src="assets/video/MechanicalRobotCycleRender.mkv">
                    <i class="fa-solid fa-play"></i> Watch Full Video
                </button>
            </div>
        </div>
    </div>

    <!-- Other video blocks (mp4) left unchanged -->

    <!-- Footer fix (was malformed) -->
    <footer class="site-footer">
        <div class="footer-content">
            <a href="mailto:wehaveabhi@gmail.com" class="footer-email">wehaveabhi@gmail.com</a>
            <div class="social-links">
                <!-- social links unchanged -->
            </div>
            <p class="footer-copyright">&copy; 2024 Wehaveabhi. All Rights Reserved.</p>
        </div>
    </footer>

    <!-- Lightbox Modal (unchanged HTML) -->
    <div id="lightbox" class="lightbox">
        <span class="lightbox-close">&times;</span>
        <img class="lightbox-content" id="lightbox-img" style="display: none;">
        <video class="lightbox-content" id="lightbox-video" controls controlsList="nodownload" style="display: none; max-height: 80vh; width: auto; max-width: 90vw;"></video>
        <a class="prev" onclick="plusSlides(-1)">&#10094;</a>
        <a class="next" onclick="plusSlides(1)">&#10095;</a>
        <div class="lightbox-caption" id="lightbox-caption"></div>
    </div>

    <script>
        // JavaScript for the filterable gallery
        document.addEventListener('DOMContentLoaded', function() {
            const filterButtons = document.querySelectorAll('.filter-btn');
            const galleryItems = document.querySelectorAll('.projects-grid .work-item');
            const lightbox = document.getElementById('lightbox');
            const lightboxImg = document.getElementById('lightbox-img');
            const lightboxVideo = document.getElementById('lightbox-video');
            const lightboxCaption = document.getElementById('lightbox-caption');
            const closeBtn = document.querySelector('.lightbox-close');
            let slideIndex = 0;
            const items = [];

            galleryItems.forEach((item, index) => {
                items.push(item);
                item.addEventListener('click', () => {
                    slideIndex = index;
                    openLightbox(item);
                });
            });

            function openLightbox(item) {
                lightbox.classList.add('active');
                const video = item.querySelector('video');
                const img = item.querySelector('img');

                if (video) {
                    lightboxImg.style.display = 'none';
                    lightboxVideo.style.display = 'block';
                    // set src from the source element (ensure it's the real URL)
                    const srcEl = video.querySelector('source');
                    lightboxVideo.src = srcEl ? srcEl.src : video.src || "";
                    lightboxCaption.textContent = item.querySelector('h3').textContent;

                    // load and play with promise handling so errors surface
                    try {
                        lightboxVideo.load();
                        const playPromise = lightboxVideo.play();
                        if (playPromise !== undefined) {
                            playPromise.catch((err) => {
                                // Autoplay might be blocked or format unsupported
                                console.warn('Lightbox video play failed:', err);
                            });
                        }
                    } catch (err) {
                        console.warn('Error loading/playing lightbox video:', err);
                    }
                } else if (img) {
                    lightboxVideo.style.display = 'none';
                    try { lightboxVideo.pause(); } catch(e){}
                    lightboxImg.style.display = 'block';
                    lightboxImg.src = img.src;
                    lightboxCaption.textContent = img.alt;
                }
            }

            function showSlides(n) {
                if (n >= items.length) { slideIndex = 0; }
                if (n < 0) { slideIndex = items.length - 1; }
                openLightbox(items[slideIndex]);
            }

            window.plusSlides = function(n) {
                showSlides(slideIndex += n);
            }

            // Function to close the lightbox
            const closeLightbox = () => {
                lightbox.classList.remove('active');
                try {
                    lightboxVideo.pause();
                    lightboxVideo.src = "";
                } catch(e){}
            };

            // Close lightbox when clicking the close button or the background
            closeBtn.addEventListener('click', closeLightbox);
            lightbox.addEventListener('click', (e) => {
                if (e.target === lightbox) { // Only close if the background is clicked
                    closeLightbox();
                }
            });

            filterButtons.forEach(button => {
                button.addEventListener('click', () => {
                    // Set active class on button
                    document.querySelector('.filter-btn.active').classList.remove('active');
                    button.classList.add('active');

                    const filter = button.getAttribute('data-filter');

                    // Show/hide gallery items based on the new filter
                    galleryItems.forEach(item => {
                        const shouldShow = filter === 'all' || item.getAttribute('data-category') === filter;

                        if (shouldShow) {
                            item.style.display = 'block';
                        } else {
                            item.style.display = 'none';
                        }
                    });
                });
            });

            document.addEventListener('keydown', function(e) {
                if (lightbox.classList.contains('active')) {
                    if (e.key === 'ArrowLeft') {
                        plusSlides(-1);
                    } else if (e.key === 'ArrowRight') {
                        plusSlides(1);
                    }
                }
            });
        });
    </script>

    <!-- Custom Cursor Script unchanged -->
</body>
</html>
